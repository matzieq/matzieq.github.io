function isSafari(){return navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&-1==navigator.userAgent.indexOf("CriOS")&&-1==navigator.userAgent.indexOf("FxiOS")}var jb=jb||{};jb._letters={A:[[,1],[1,,1],[1,1,1],[1,,1],[1,,1]],B:[[1,1],[1,,1],[1,1],[1,,1],[1,1]],C:[[,1,1],[1],[1],[1],[,1,1]],D:[[1,1],[1,,1],[1,,1],[1,,1],[1,1]],E:[[1,1,1],[1],[1,1],[1],[1,1,1]],F:[[1,1,1],[1],[1,1],[1],[1]],G:[[,1,1],[1],[1,,1],[1,,1],[,1,1]],H:[[1,,1],[1,,1],[1,1,1],[1,,1],[1,,1]],I:[[1,1,1],[,1],[,1],[,1],[1,1,1]],J:[[,,1],[,,1],[,,1],[1,,1],[1,1,1]],K:[[1,,1],[1,,1],[1,1],[1,,1],[1,,1]],L:[[1],[1],[1],[1],[1,1,1]],M:[[1,,1],[1,1,1],[1,1,1],[1,,1],[1,,1]],N:[[1,1],[1,,1],[1,,1],[1,,1],[1,,1]],O:[[,1,1],[1,,1],[1,,1],[1,,1],[1,1]],P:[[1,1],[1,,1],[1,1],[1],[1]],Q:[[0,1,1],[1,,1],[1,,1],[1,1,1],[,1,1]],R:[[1,1],[1,,1],[1,1],[1,,1],[1,,1]],S:[[,1,1],[1],[1,1,1],[,,1],[1,1]],T:[[1,1,1],[,1],[,1],[,1],[,1]],U:[[1,,1],[1,,1],[1,,1],[1,,1],[1,1,1]],V:[[1,,1],[1,,1],[1,,1],[1,,1],[,1]],W:[[1,,1],[1,,1],[1,,1],[1,1,1],[1,1,1]],X:[[1,,1],[1,,1],[,1],[1,,1],[1,,1]],Y:[[1,,1],[1,,1],[,1],[,1],[,1]],Z:[[1,1,1],[,,1],[,1],[1],[1,1,1]],0:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],1:[[1,1],[,1],[,1],[,1],[1,1,1]],2:[[1,1,1],[0,0,1],[1,1,1],[1,0,0],[1,1,1]],3:[[1,1,1],[0,0,1],[1,1,1],[0,0,1],[1,1,1]],4:[[1,0,1],[1,0,1],[1,1,1],[0,0,1],[0,0,1]],5:[[1,1,1],[1,0,0],[1,1,1],[0,0,1],[1,1,1]],6:[[1,1,1],[1,0,0],[1,1,1],[1,0,1],[1,1,1]],7:[[1,1,1],[0,0,1],[0,0,1],[0,0,1],[0,0,1]],8:[[1,1,1],[1,0,1],[1,1,1],[1,0,1],[1,1,1]],9:[[1,1,1],[1,0,1],[1,1,1],[0,0,1],[1,1,1]]," ":[[,,],[,,],[,,],[,,],[,,]],",":[[,,,],[,,,],[,,,],[,1,,],[1]],".":[[,,,],[,,,],[,,,],[,,,],[,1]],"!":[[1],[1],[1],[,],[1]],"?":[[1,1],[,,1],[,1],[,],[,1]],"(":[[,1],[1,,],[1,,],[1,,],[,1]],")":[[,1],[,,1],[,,1],[,,1],[,1]],"[":[[1,1],[1,,],[1,,],[1,,],[1,1]],"]":[[,1,1],[,,1],[,,1],[,,1],[,1,1]],"{":[[,1,1],[,1,,],[1,1],[,1,,],[,1,1]],"}":[[1,1],[,1],[,1,1],[,1],[1,1]],"'":[[1],[1],[,],[,],[,]],'"':[[1,,1],[1,,1],[,,],[,,],[,,]],"%":[[1,,1],[,,1],[,1],[1],[1,,1]],"&":[[1,1],[1,1],[1,1],[1,,1],[1,1,1]],"-":[[,,],[,,],[1,1,1],[,,],[,,]],"+":[[,],[,1],[1,1,1],[,1],[,]],"*":[[1,,1],[,1],[1,1,1],[,1],[1,,1]],"/":[[,,1],[,,1],[,1],[1,,],[1,,]],":":[[,,],[,1],[,,],[,1],[,,]],";":[[,,],[,1],[,,],[,1],[1,,]],_:[[,,],[,,],[,,],[,,],[1,1,1]]},jb._origPal=[[251,245,239],[242,211,171],[198,159,165],[139,109,156],[73,77,126],[39,39,68]],jb._rgbPal=[...jb._origPal],jb._screenSize=128,jb._transparent=[!1,!1,!1,!1,!1,!0],jb._dataSet=[0],jb.BTN_LEFT=0,jb.BTN_UP=1,jb.BTN_RIGHT=2,jb.BTN_DOWN=3,jb.BTN_A=4,jb.BTN_B=5,jb.BTN_START=6,jb.BTN_SELECT=7,jb._middleC=440*Math.pow(Math.pow(2,1/12),-9),jb._cam={x:0,y:0},jb._keys={left:{pressed:!1,justPressed:!1},up:{pressed:!1,justPressed:!1},right:{pressed:!1,justPressed:!1},down:{pressed:!1,justPressed:!1},a:{pressed:!1,justPressed:!1},b:{pressed:!1,justPressed:!1},start:{pressed:!1,justPressed:!1},select:{pressed:!1,justPressed:!1}},jb._drawColor=0,jb._screenBuffer=null,jb._getClearScreenData=function(e){const t=new Uint8ClampedArray(65536);for(let s=0;s<65536;s+=4){const[i,r,a]=this._rgbPal[null!=e?e:5];t[s]=i,t[s+1]=r,t[s+2]=a,t[s+3]=255}return t},jb.init=function(e){window.AudioContext=window.AudioContext||window.webkitAudioContext;this._jbcanv=document.createElement("canvas"),this._jbcanv.width=1*this._screenSize,this._jbcanv.height=1*this._screenSize,this._jbctx=this._jbcanv.getContext("2d"),this._jbctx.scale(1,1),this._actx=new AudioContext,this._jbctx.imageSmoothingEnabled=!1,document.body.appendChild(this._jbcanv),this._draw=e&&e.draw?e.draw:function(){},this._update=e&&e.update?e.update:function(){};const t=document.createElement("style");t.textContent="\n    * {\n      padding: 0;\n      margin: 0;\n      box-sizing: border-box;\n    }\n    body {\n      background-color: #000;\n    }\n\n    canvas {\n      display: block;\n      margin: 0 auto;\n      image-rendering: pixelated;\n      image-rendering: crisp-edges;\n    }\n  ",document.head.appendChild(t),this._fitToScreen(),this._screenBuffer=new ImageData(new Uint8ClampedArray(65536),128,128),window.addEventListener("resize",()=>this._fitToScreen()),window.addEventListener("keydown",e=>this._onKeyPressed(e)),window.addEventListener("keyup",e=>this._onKeyReleased(e)),window.requestAnimationFrame(e=>this._step(e)),"function"==typeof e.init&&e.init()},jb._fitToScreen=function(){window.innerWidth>window.innerHeight?(this._jbcanv.style.height="100vh",this._jbcanv.style.width="auto"):(this._jbcanv.style.width="100vw",this._jbcanv.style.height="auto")},jb._step=function(e){this._lastFrame||(this._lastFrame=0);const t=e-this._lastFrame;this._frameRate=1e3/t,this._lastFrame=e,this._update(t/1e3),this._draw(),this._jbctx.putImageData(this._screenBuffer,0,0),window.requestAnimationFrame(e=>this._step(e))},jb.cls=function(e){const t=this._getClearScreenData(e);for(let e=0;e<t.length;e++)this._screenBuffer.data[e]=t[e]},jb.camera=function(e,t){this._cam={x:e,y:t}},jb.spr=function(e,t,s){const i=this._data[this._dataSet].sprites.slice(64*e,64*(e+1)),{x:r,y:a}=this._adjustCoords(t,s);r>-8&&r<this._screenSize&&a>-8&&a<this._screenSize&&i.forEach((e,t)=>{const s=r+t%8,i=a+Math.floor(t/8);this._transparent[e]||this._updatePixel(s,i,...this._rgbPal[e])})},jb._updatePixel=function(e,t,s,i,r){if(this._isOnScreen(e,t)){const a=4*(128*t+e);a<this._screenBuffer.data.length-3&&(this._screenBuffer.data[a]=s,this._screenBuffer.data[a+1]=i,this._screenBuffer.data[a+2]=r,this._screenBuffer.data[a+3]=255)}},jb.color=function(e){e>=0&&e<this._rgbPal.length&&(this._drawColor=e)},jb.print=function(e,t,s,i=this._drawColor){const r=[],a="string"==typeof e?e.toUpperCase():e.toString().toUpperCase(),{x:n,y:o}=this._adjustCoords(t,s);for(let e=0;e<a.length;e++){const t=this._letters[a.charAt(e)];t&&r.push(t)}let h=0;r.forEach(e=>{let t=0,s=0;e.forEach(e=>{e.forEach((e,s)=>{e&&this._updatePixel(h+n+s,t+o,...this._rgbPal[i])}),s=Math.max(s,e.length),t+=1}),h+=1+s})},jb._circ=function(e,t,s,i=this._drawColor,r=!1){const{x:a,y:n}=this._adjustCoords(e,t);for(let e=-s;e<=s;e++)for(let t=-s;t<=s;t++){const o=t+a,h=e+n;if(r){if(t*t+e*e>=s*s)continue}else if(Math.abs(t*t+e*e-s*s)>s)continue;this._updatePixel(o,h,...this._rgbPal[i])}},jb.circ=function(e,t,s,i){jb._circ(e,t,s,i)},jb.circfill=function(e,t,s,i){jb._circ(e,t,s,i,!0)},jb.rect=function(e,t,s,i,r){this._rect(e,t,s,i,r,!1)},jb.rectfill=function(e,t,s,i,r){this._rect(e,t,s,i,r,!0)},jb._adjustCoords=function(e,t){return{x:Math.round(e-this._cam.x),y:Math.round(t-this._cam.y)}},jb._rect=function(e,t,s,i,r=this._drawColor,a=!1){e>s&&([e,s]=[s,e]),t>i&&([t,i]=[i,t]);const{x:n,y:o}=this._adjustCoords(e,t),{x:h,y:c}=this._adjustCoords(s,i),[d,u,_]=this._rgbPal[r];if(a)for(let e=o;e<=c;e++)for(let t=n;t<=h;t++)this._updatePixel(t,e,d,u,_);else{for(let e=o;e<=c;e++)this._updatePixel(n,e,d,u,_),this._updatePixel(h,e,d,u,_);for(let e=n;e<=h;e++)this._updatePixel(e,o,d,u,_),this._updatePixel(e,c,d,u,_)}},jb._isOnScreen=function(e,t){return e>=0&&e<this._screenSize&&t>=0&&t<this._screenSize},jb.map=function(e,t){const s=8*Math.floor(e||0),i=8*Math.floor(t||0);for(let e=0;e<64;e++){const t=e%8,r=Math.floor(e/8);this._data[this._dataSet].map.slice(256*e,256*(e+1)).forEach((e,a)=>{const n=a%16,o=Math.floor(a/16),h=s+128*t+8*n,c=i+128*r+8*o;h-this._cam.x<-8||h-this._cam.x>128||c-this._cam.y<-8||c-this._cam.y>128||this.spr(e,h,c)})}},jb.mget=function(e,t){if(e<0||t<0||e>128||t>128)return"";const s=Math.floor(e/16),i=Math.floor(t/16),r=Math.floor(e%16),a=8*i+s,n=16*Math.floor(t%16)+r,o=this._data[this._dataSet].map[256*a+n];return null!=o?o:""},jb.mset=function(e,t,s){if(e<0||t<0||e>128||t>128||s<0||s>63)return;const i=Math.floor(e/16),r=Math.floor(t/16),a=Math.floor(e%16),n=8*r+i,o=16*Math.floor(t%16)+a;this._data[this._dataSet].map[256*n+o]=s},jb.sget=function(e,t){if(e<0||t<0||e>63||t>63)return"";const s=Math.floor(e/8),i=Math.floor(t/8),r=Math.floor(e%8),a=8*i+s,n=8*Math.floor(t%8)+r,o=this._data[this._dataSet].sprites[64*a+n];return null!=o?o:""},jb.sset=function(e,t,s=this._drawColor){if(e<0||t<0||e>63||t>63||s<0||s>5)return;const i=Math.floor(e/8),r=Math.floor(t/8),a=Math.floor(e%8),n=8*r+i,o=8*Math.floor(t%8)+a;this._data[this._dataSet].sprites[64*n+o]=s},jb.fget=function(e,t){return e<0||e>63||null!=t&&t<0||null!=t&&t>7?null:null==t?this._data[this._dataSet].spriteFlags[e]:!!(this._data[this._dataSet].spriteFlags[e]&1<<t)},jb.fset=function(e,t,s){if(!(e<0||e>63||null!=s&&(t<0||t>7)||null==s&&(t<0||t>255)))if(null==s)this._data[this._dataSet].spriteFlags[e]=t;else{const i=1<<t;s?this._data[this._dataSet].spriteFlags[e]|=i:this._data[this._dataSet].spriteFlags[e]&=~i}},jb.pget=function(e,t){if(this._isOnScreen(e,t)){const s=4*(128*t+e),[i,r,a]=this._screenBuffer.data.slice(s,s+4);return this._rgbPal.findIndex(e=>e[0]===i&&e[1]===r&&e[2]===a)}return""},jb.pset=function(e,t,s=this._drawColor){s>=0&&s<=5&&this._updatePixel(e,t,...this._rgbPal[s])},jb._resetKeys=function(){for(key in this._keys)this._keys[key].justPressed=!1},jb._onKeyPressed=function(e){switch(this._actx.resume(),e.key.toLowerCase()){case"arrowup":this._keys.up.pressed=!0,this._keys.up.justPressed=!0;break;case"arrowdown":this._keys.down.pressed=!0,this._keys.down.justPressed=!0;break;case"arrowleft":this._keys.left.pressed=!0,this._keys.left.justPressed=!0;break;case"arrowright":this._keys.right.pressed=!0,this._keys.right.justPressed=!0;break;case"z":case"c":this._keys.a.pressed=!0,this._keys.a.justPressed=!0;break;case"x":this._keys.b.pressed=!0,this._keys.b.justPressed=!0;break;case"escape":this._keys.start.pressed=!0,this._keys.start.justPressed=!0;break;case"tab":this._keys.select.pressed=!0,this._keys.select.justPressed=!0}},jb._onKeyReleased=function(e){switch(e.key){case"ArrowUp":this._keys.up.pressed=!1;break;case"ArrowDown":this._keys.down.pressed=!1;break;case"ArrowLeft":this._keys.left.pressed=!1;break;case"ArrowRight":this._keys.right.pressed=!1;break;case"z":case"c":this._keys.a.pressed=!1;break;case"x":this._keys.b.pressed=!1;break;case"Escape":this._keys.start.pressed=!1;break;case"Tab":this._keys.select.pressed=!1}},jb.btn=function(e){switch(e){case 0:return this._keys.left.pressed;case 1:return this._keys.up.pressed;case 2:return this._keys.right.pressed;case 3:return this._keys.down.pressed;case 4:return this._keys.a.pressed;case 5:return this._keys.b.pressed;case 6:return this._keys.start.pressed;case 7:return this._keys.select.pressed}},jb.btnp=function(e){switch(e){case 0:return!!this._keys.left.justPressed&&(this._keys.left.justPressed=!1,!0);case 1:return!!this._keys.up.justPressed&&(this._keys.up.justPressed=!1,!0);case 2:return!!this._keys.right.justPressed&&(this._keys.right.justPressed=!1,!0);case 3:return!!this._keys.down.justPressed&&(this._keys.down.justPressed=!1,!0);case 4:return!!this._keys.a.justPressed&&(this._keys.a.justPressed=!1,!0);case 5:return!!this._keys.b.justPressed&&(this._keys.b.justPressed=!1,!0);case 6:return!!this._keys.start.justPressed&&(this._keys.start.justPressed=!1,!0);case 7:return!!this._keys.select.justPressed&&(this._keys.select.justPressed=!1,!0)}},jb._getFrequency=function(e,t=0){return freq=this._middleC*Math.pow(Math.pow(2,1/12),e),freq*Math.pow(2,t)},jb._soundEffect=function(e,t,s,i,r,a,n,o){void 0===t&&(t=200),void 0===s&&(s="sine"),void 0===i&&(i=1),void 0===r&&(r=0),void 0===a&&(a=2);const h=a/4,c=a,d=e.createOscillator(),u=e.createGain();switch(d.connect(u),u.connect(e.destination),d.type=s,d.frequency.value=t,u.gain.value=i,isSafari()||function(t){"fade-in"!==n&&(t.gain.value=0,t.gain.linearRampToValueAtTime(0,e.currentTime+r),t.gain.linearRampToValueAtTime(i,e.currentTime+r+.01));"fade-out"!==n&&(t.gain.linearRampToValueAtTime(i,e.currentTime+r+a-.01),t.gain.linearRampToValueAtTime(0,e.currentTime+r+a-.001))}(u),n){case"fade-in":(_=u).gain.value=0,_.gain.linearRampToValueAtTime(0,e.currentTime+r),_.gain.linearRampToValueAtTime(i,e.currentTime+r+h);break;case"fade-out":!function(t){t.gain.linearRampToValueAtTime(i,e.currentTime+r),t.gain.linearRampToValueAtTime(0,e.currentTime+r+c)}(u);break;case"vibrato":!function(s){const i=[];for(let e=0;e<a;e+=.01)i.push(t+Math.sin(40*e)*(t/40));s.setValueCurveAtTime(new Float32Array(i),e.currentTime+r,a)}(d.frequency);break;case"slide":!function(s){if(!o)return;const i=[t,o];s.setValueCurveAtTime(new Float32Array(i),e.currentTime+r,a)}(d.frequency)}var _,l;(l=d).start(e.currentTime+r),l.stop(e.currentTime+r+a)},jb.sfx=function(e){const t=this._data[this._dataSet].sfx[e],s=t.tempo/64;for(let e=0;e<t.samples.length;e++){const i=t.samples[e];let r=1;if(!["fade-in","fade-out"].includes(i.fx))for(let s=e+1;s<t.samples.length;s++){const e=t.samples[s];if(!e||e.dist!==i.dist||e.type!==i.type||e.volume!==i.volume||e.fx!==i.fx)break;r++}this._soundEffect(this._actx,this._getFrequency(i.dist),i.type,i.volume/40,s*e,s*r,i.fx,t.samples[e+1]?this._getFrequency(t.samples[e+1].dist):null),e+=r-1}},jb._createImageData=function(){this._images=[];for(let e=0;e<64;e++){const t=this._data[this._dataSet].sprites.slice(64*e,64*(e+1)).map(e=>{const t=this._transparent[e]?0:255;return[...this._rgbPal[e],t]}).flat(),s=new ImageData(new Uint8ClampedArray(t),8,8);this._images.push(s)}},jb.palt=function(e,t){null!=e||null!=t?e>=0&&e<this._origPal.length&&(this._transparent[e]=t):this._transparent=[!1,!1,!1,!1,!1,!0]},jb.pal=function(e,t){null!=t?this._rgbPal[e]=this._origPal[t]:null==e&&(this._rgbPal=[...this._origPal],this._transparent=[!1,!1,!1,!1,!1,!0])},jb.__5w17Chd474537=function(e){e>0&&e<this._data.length&&(this._dataSet=e)},jb.line=function(e,t,s,i,r=this._drawColor){let{x:a,y:n}=this._adjustCoords(e,t),{x:o,y:h}=this._adjustCoords(s,i);const c=Math.abs(o-a),d=Math.abs(h-n),u=a<o?1:-1,_=n<h?1:-1;let l=c-d;for(;this._updatePixel(a,n,...this._rgbPal[r]),a!==o||n!==h;){const e=2*l;e>-d&&(l-=d,a+=u),e<c&&(l+=c,n+=_)}};